/*! Crocodoc Viewer - v0.4.0 | (c) 2014 Box */
var Crocodoc=function(a){var b=function(){"use strict";function a(b,d,e){var f;for(e=e||b,f=0;f<d.length;++f){if(b===d[f])throw new Error("Circular dependency detected: "+e+"->"+d[f]);c[d[f]]&&a(b,c[d[f]].mixins,e+"->"+d[f])}}var c={},d={};return{ZOOM_FIT_WIDTH:"fitwidth",ZOOM_FIT_HEIGHT:"fitheight",ZOOM_AUTO:"auto",ZOOM_IN:"in",ZOOM_OUT:"out",SCROLL_PREVIOUS:"previous",SCROLL_NEXT:"next",LAYOUT_VERTICAL:"vertical",LAYOUT_VERTICAL_SINGLE_COLUMN:"vertical-single-column",LAYOUT_HORIZONTAL:"horizontal",LAYOUT_PRESENTATION:"presentation",LAYOUT_PRESENTATION_TWO_PAGE:"presentation-two-page",PAGE_STATUS_CONVERTING:"converting",PAGE_STATUS_NOT_LOADED:"not loaded",PAGE_STATUS_LOADING:"loading",PAGE_STATUS_LOADED:"loaded",PAGE_STATUS_ERROR:"error",components:c,utilities:d,createViewer:function(a,c){return new b.Viewer(a,c)},addComponent:function(b,d,e){d instanceof Function&&(e=d,d=[]),a(b,d),c[b]={mixins:d,creator:e}},createComponent:function(a,b){var d=c[a];if(d){for(var e=[],f=0;f<d.mixins.length;++f)e.push(this.createComponent(d.mixins[f],b));return e.unshift(b),d.creator.apply(d.creator,e)}return null},addPlugin:function(a,b){this.addComponent("plugin-"+a,b)},addUtility:function(a,b){d[a]={creator:b,instance:null}},getUtility:function(a){var b=d[a];return b?(b.instance||(b.instance=b.creator(this)),b.instance):null}}}();return function(){"use strict";b.Scope=function(a){var c=b.getUtility("common"),d=[];this.createComponent=function(a){var c=b.createComponent(a,this);return c&&(c.componentName=a,d.push(c)),c},this.destroyComponent=function(a){var b,c;for(b=0,c=d.length;c>b;++b)if(a===d[b]){"function"==typeof a.destroy&&a.destroy(),d.splice(b,1);break}},this.destroy=function(){var a,b,c;for(a=0,b=d.length;b>a;++a)c=d[a],"function"==typeof c.destroy&&c.destroy();d=[]},this.broadcast=function(a,b){var e,f,g,h;for(e=0,f=d.length;f>e;++e)g=d[e],g&&(h=g.messages||[],-1!==c.inArray(a,h)&&"function"==typeof g.onmessage&&g.onmessage.call(g,a,b))},this.getUtility=function(a){return b.getUtility(a)},this.getConfig=function(){return a}}}(),function(){"use strict";b.EventTarget=function(){this._handlers={}},b.EventTarget.prototype={constructor:b.EventTarget,on:function(a,b){"undefined"==typeof this._handlers[a]&&(this._handlers[a]=[]),this._handlers[a].push(b)},fire:function(a,b){var c,d,e,f={type:a,data:b};if(c=this._handlers[f.type],c instanceof Array)for(c=c.concat(),d=0,e=c.length;e>d;d++)c[d]&&c[d].call(this,f);if(c=this._handlers.all,c instanceof Array)for(c=c.concat(),d=0,e=c.length;e>d;d++)c[d]&&c[d].call(this,f)},off:function(a,b){var c,d,e=this._handlers[a];if(e instanceof Array){if(!b)return void(e.length=0);for(c=0,d=e.length;d>c;c++)if(e[c]===b||e[c].handler===b){e.splice(c,1);break}}},one:function(a,b){var c=this,d=function(e){c.off(a,d),b.call(c,e)};d.handler=b,this.on(a,d)}}}(),function(){"use strict";var c="crocodoc-text-disabled",d="crocodoc-links-disabled",e=0;b.Viewer=function(f,g){function h(a,b){n?q.broadcast(a,b):o.push({name:a,data:b})}function i(){for(var a;o.length;)a=o.shift(),q.broadcast(a.name,a.data)}function j(){n=!0,i()}b.EventTarget.call(this);var k,l=b.getUtility("common"),m=a(f),n=!1,o=[],p=l.extend(!0,{},b.Viewer.defaults,g),q=new b.Scope(p),r=q.createComponent("viewer-base");if(0===m.length)throw new Error("Invalid container element");p.id=++e,p.api=this,p.$el=m,r.init(),this.destroy=function(){q.broadcast("destroy"),q.destroy()},this.load=function(){return p.url?(/\/$/.test(p.url)||(p.url+="/"),r.loadAssets(),void this.one("ready",j)):void q.broadcast("fail",{error:"no URL given for assets"})},this.setLayout=function(a){k=r.setLayout(a)},this.zoom=function(a){var b=parseFloat(a);k&&(b&&(a=b/(p.pageScale||1)),k.setZoom(a))},this.scrollTo=function(a){k&&k.scrollTo(a)},this.scrollBy=function(a,b){k&&k.scrollBy(a,b)},this.focus=function(){k&&k.focus()},this.enableTextSelection=function(){p.enableTextSelection||(m.removeClass(c),p.enableTextSelection=!0,q.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){p.enableTextSelection&&(m.addClass(c),p.enableTextSelection=!1,q.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){p.enableLinks||(m.removeClass(d),p.enableLinks=!0)},this.disableLinks=function(){p.enableLinks&&(m.addClass(d),p.enableLinks=!1)},this.updateLayout=function(){k&&(k.updatePageStates(!0),k.setZoom())},this.setPageAvailable=function(a){h("pageavailable",{page:a})},this.setPagesAvailableUpTo=function(a){h("pageavailable",{upto:a})},this.setAllPagesAvailable=function(){n?q.broadcast("pageavailable",{upto:p.numPages}):p.conversionIsComplete=!0}},b.Viewer.prototype=new b.EventTarget,b.Viewer.prototype.constructor=b.Viewer,b.Viewer.defaults={url:null,layout:b.LAYOUT_VERTICAL,zoom:b.ZOOM_AUTO,page:1,enableTextSelection:!0,enableLinks:!0,queryParams:null,plugins:{},enableDragging:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},pageStart:null,pageEnd:null,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),b.addUtility("ajax",function(a){"use strict";function b(a){var b,c,d;try{b=a.status,c=a.statusText,d=a.responseText}catch(e){b=0,c="",d=null}return{status:b,statusText:c,responseText:d}}var c=a.getUtility("common");return{request:function(a,d){function e(){c.isFn(d.success)&&d.success.call(b(h))}function f(){c.isFn(d.fail)&&d.fail.call(b(h))}d=d||{};var g=d.method||"GET",h=new window.XMLHttpRequest;if(!c.isCrossDomain(a)||"withCredentials"in h)h.open(g,a,!0),h.onreadystatechange=function(){if(4===this.readyState){h.onreadystatechange=null;try{200===this.status?e():f()}catch(a){f()}}},h.send();else if("XDomainRequest"in window){h=new window.XDomainRequest;try{h.open(g,a),h.onload=e,h.onerror=f,h.ontimeout=f,h.onprogress=function(){},h.send()}catch(i){h={status:0,statusText:i.message},f()}}else h={status:0,statusText:"CORS not supported"},f();return h}}}),b.addUtility("browser",function(){"use strict";var a,b,c,d,e,f,g=navigator.userAgent,h={};return a=/iphone|ipod|ipad/i.test(g),b=/android/i.test(g),d=/webos/i.test(g),c=/blackberry/i.test(g),e=/blackberry/i.test(g),f=/MSIE/i.test(g),f&&(h.ie=!0,h.version=parseFloat(/MSIE\s+(\d+\.\d+)/i.exec(g)[1]),h.ielt9=h.version<9,h.ielt10=h.version<10),a&&(h.ios=!0),h.mobile=/mobile/i.test(g)||a||b||c||d||e,h.firefox=/firefox/i.test(g),/safari/i.test(g)&&(h.chrome=/chrome/i.test(g),h.safari=!h.chrome),h}),b.addUtility("common",function(){"use strict";var b={};return b.extend=a.extend,b.each=a.each,b.map=a.map,b.parseJSON=a.parseJSON,a.extend(b,{bisectLeft:function(a,b,c){for(var d,e,f=0,g=a.length;g>f;)e=Math.floor((f+g)/2),d=c?a[e][c]:a[e],b>d?f=e+1:g=e;return f},bisectRight:function(a,b,c){for(var d,e,f=0,g=a.length;g>f;)e=Math.floor((f+g)/2),d=c?a[e][c]:a[e],d>b?g=e:f=e+1;return f},clamp:function(a,b,c){return b>a?b:a>c?c:a},sign:function(a){var b=parseInt(a,10);return b?0>b?-1:1:b},isFn:function(a){return"function"==typeof a},inArray:function(c,d){return b.isFn(d.indexOf)?d.indexOf(c):a.inArray(c,d)},constrainRange:function(a,c,d){var e=c-a;return a=b.clamp(a,0,d),c=b.clamp(a+e,0,d),e>c-a&&(a=b.clamp(c-e,0,d)),{min:a,max:c}},makeAbsolute:function(a){var b=window.location,c=b.pathname;return/^http|^\/\//i.test(a)?a:("/"!==a.charAt(0)&&(c.lastIndexOf("/")!==c.length-1&&(c=c.substring(0,c.lastIndexOf("/")+1)),a=c+a),b.protocol+"//"+b.host+a)},now:function(){return(new Date).getTime()},throttle:function(a,c){function d(){i=b.now(),g=null,h=c.apply(e,f)}var e,f,g,h,i=0;return function(){var j=b.now(),k=a-(j-i);return e=this,f=arguments,0>=k?(clearTimeout(g),g=null,i=j,h=c.apply(e,f)):g||(g=setTimeout(d,k)),h}},debounce:function(a,c){function d(){var j=b.now()-h;a>j?g=setTimeout(d,a-j):(g=null,i=c.apply(e,f),e=f=null)}var e,f,g,h,i;return function(){return e=this,f=arguments,h=b.now(),g||(g=setTimeout(d,a)),i}},insertCSS:function(a){var b=document.createElement("style"),c=document.createTextNode(a);try{b.setAttribute("type","text/css"),b.appendChild(c)}catch(d){}return document.getElementsByTagName("head")[0].appendChild(b),b},appendCSSRule:function(a,b,c){var d;return a.insertRule?a.insertRule(b+"{"+c+"}",a.cssRules.length):(d=a.addRule(b,c,a.rules.length),0>d&&(d=a.rules.length-1),d)},deleteCSSRule:function(a,b){a.deleteRule?a.deleteRule(b):a.removeRule(b)},getSelectedNode:function(){var a,b,c;return window.getSelection?(b=window.getSelection(),b.rangeCount&&(c=b.getRangeAt(0),c.collapsed||(a=b.anchorNode.parentNode))):document.selection&&(a=document.selection.createRange().parentElement()),a},getComputedStyle:function(a){return"getComputedStyle"in window?window.getComputedStyle(a):a.currentStyle},calculatePtSize:function(){var a,c,d=1e4,e=document.createElement("div");return e.style.display="block",e.style.position="absolute",e.style.width=d+"pt",document.body.appendChild(e),a=b.getComputedStyle(e).width,c=parseFloat(a)/d,document.body.removeChild(e),c},countInStr:function(a,b){for(var c,d=0;c=a.indexOf(b,c)+1;)d++;return d},template:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a=a.replace(new RegExp("\\{\\{"+c+"\\}\\}","g"),b[c]));return a},isCrossDomain:function(a){function b(a){return a.replace(c,"").split("/")[0]}var c=/^(http(s)?|file)+:\/\//;return c.test(a)&&b(location.href)!==b(a)}})}),b.addUtility("subpx",function(b){"use strict";function c(){if(!a.support.leadingWhitespace)return!1;var b=a(f.template(e,{size:12.5})).appendTo(document.documentElement).get(0),c=a(b).css("font-size"),d=a(b).width();a(b).remove(),b=a(f.template(e,{size:12.6})).appendTo(document.documentElement).get(0);var g=a(b).css("font-size"),h=a(b).width();if(a(b).remove(),!("ontouchstart"in window)){if(c===g)return!1;if(d===h)return!1}return!0}var d="crocodoc-subpx-fix",e='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",f=b.getUtility("common"),g=c();return{fix:function(b){if(!g&&void 0!==document.body.style.zoom){var c=a("<div>").addClass(d);a(b).children().wrapAll(c)}return b},isSubpxSupported:function(){return g}}}),b.addUtility("support",function(){"use strict";function a(a){var c,d,f,g=document.createElement("div");if(a in g.style)return a;if(c=a.charAt(0).toUpperCase()+a.substr(1),a in g.style)return a;for(d=0;d<e.length;++d)if(f=e[d]+c,f in g.style)return 0===f.indexOf("ms")&&(f="-"+f),b(f);return!1}function b(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}var c,d,e=["Moz","Webkit","O","ms"];return function(){for(var a=0,b=["ms","moz","webkit","o"],e=0;e<b.length&&!c;++e)c=window[b[e]+"RequestAnimationFrame"],d=window[b[e]+"CancelAnimationFrame"]||window[b[e]+"CancelRequestAnimationFrame"];c||(c=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),d||(d=function(a){clearTimeout(a)})}(),{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:a("transform"),csstransition:a("transition"),csszoom:a("zoom"),requestAnimationFrame:function(){return c.apply(window,arguments)},cancelAnimationFrame:function(){d.apply(window,arguments)}}}),b.addComponent("dragger",function(b){"use strict";function c(a){f.scrollTop(g.top-(a.clientY-h.y)),f.scrollLeft(g.left-(a.clientX-h.x)),a.preventDefault()}function d(a){b.broadcast("dragend"),i.off("mousemove",c),i.off("mouseup",d),a.preventDefault()}function e(a){b.broadcast("dragstart"),g={top:f.scrollTop(),left:f.scrollLeft()},h={x:a.clientX,y:a.clientY},i.on("mousemove",c),i.on("mouseup",d),a.preventDefault()}var f,g,h,i=a(window);return{init:function(b){f=a(b),f.on("mousedown",e)},destroy:function(){f.off("mousedown",e),f.off("mousemove",c),i.off("mouseup",d)}}}),b.addComponent("layout-base",function(a){"use strict";function c(a,b){var c,d,e,f,g=a.state,h="."+a.config.namespace+" ."+i,j=a.config.stylesheet,k=g.pages,l=b*a.config.pageScale,m=100/l;for(f=p.csstransform?p.csstransform+":scale("+l+");width:"+m+"%;height:"+m+"%;":p.csszoom?"zoom:"+l:"",g.previousStyleIndex&&o.deleteCSSRule(j,g.previousStyleIndex),g.previousStyleIndex=o.appendCSSRule(j,h,f),c=0,d=k.length;d>c;++c)e=k[c],a.$pages.eq(c).css({width:e.actualWidth*b,height:e.actualHeight*b,paddingTop:e.paddingTop*b,paddingRight:e.paddingRight*b,paddingBottom:e.paddingBottom*b,paddingLeft:e.paddingLeft*b})}function d(a,b){if(!b||0===b.length)return 1/0;var c=o.map(b,function(b){return a[b].y1});return Math.max.apply(Math,c)}var e="crocodoc-layout-",f="crocodoc-current-page",g="crocodoc-page-",h=g+"visible",i=g+"overlay",j="padding-",k=j+"top",l=j+"right",m=j+"left",n=j+"bottom",o=a.getUtility("common"),p=a.getUtility("support");return{messages:["resize","scroll","scrollend"],onmessage:function(a,b){switch(a){case"resize":this.handleResize(b);break;case"scroll":this.handleScroll(b);break;case"scrollend":this.handleScrollEnd(b)}},init:function(){var b=a.getConfig();this.config=b,this.$el=b.$el,this.$doc=b.$doc,this.$viewport=b.$viewport,this.$pages=b.$pages,this.$pagesWrapper=b.$pagesWrapper,this.numPages=b.numPages,this.layoutClass=e+b.layout,this.$el.addClass(this.layoutClass),this.initState(),this.initZoomLevels(),this.updatePageStates()},initState:function(){var a=this.$viewport[0];this.state={pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],scrollTop:a.scrollTop,scrollLeft:a.scrollLeft,viewportDimensions:{clientWidth:a.clientWidth,clientHeight:a.clientHeight,offsetWidth:a.offsetWidth,offsetHeight:a.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},currentPage:null,visiblePages:[],fullyVisiblePages:[],initialWidth:0,initialHeight:0},this.zoomLevels=[]},destroy:function(){this.$pagesWrapper.add(this.$doc).removeAttr("style"),this.$pages.css("padding",""),this.$el.removeClass(this.layoutClass)},setZoom:function(c){var d,e,f=this.state,g=this.parseZoomValue(c),h=f.zoomState,i=h.zoom;d=this.calculateZoomMode(c,g),g=o.clamp(g,f.minZoom,f.maxZoom),a.broadcast("beforezoom",o.extend({page:f.currentPage,visiblePages:o.extend([],f.visiblePages),fullyVisiblePages:o.extend([],f.fullyVisiblePages)},h)),h.prevZoom=i,h.zoom=g,h.zoomMode=d,this.applyZoom(g),h.canZoomIn=this.calculateNextZoomLevel(b.ZOOM_IN)!==!1,h.canZoomOut=this.calculateNextZoomLevel(b.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),e=c===b.ZOOM_AUTO||c===b.ZOOM_FIT_WIDTH||c===b.ZOOM_FIT_HEIGHT,this.updateScrollPosition(e),this.updatePageStates(),this.updateVisiblePages(!0),a.broadcast("zoom",o.extend({page:f.currentPage,visiblePages:o.extend([],f.visiblePages),fullyVisiblePages:o.extend([],f.fullyVisiblePages),isDraggable:this.isDraggable()},h))},isDraggable:function(){var a=this.state;return a.viewportDimensions.clientHeight<a.totalHeight||a.viewportDimensions.clientWidth<a.totalWidth},parseZoomValue:function(a){var c=parseFloat(a),d=this.state,e=d.zoomState,f=e.zoom,g=f;if(c)g=c;else switch(a){case b.ZOOM_FIT_WIDTH:case b.ZOOM_FIT_HEIGHT:case b.ZOOM_AUTO:g=this.calculateZoomValue(a);break;case b.ZOOM_IN:case b.ZOOM_OUT:g=this.calculateNextZoomLevel(a)||f;break;default:g=f?e.zoomMode?this.calculateZoomValue(e.zoomMode):f:this.calculateZoomValue(this.config.zoom||b.ZOOM_AUTO)}return g},calculateZoomMode:function(a,c){switch(c){case this.calculateZoomValue(b.ZOOM_AUTO):return"string"!=typeof a||a!==b.ZOOM_FIT_WIDTH&&a!==b.ZOOM_FIT_HEIGHT?b.ZOOM_AUTO:a;case this.calculateZoomValue(b.ZOOM_FIT_WIDTH):return b.ZOOM_FIT_WIDTH;case this.calculateZoomValue(b.ZOOM_FIT_HEIGHT):return b.ZOOM_FIT_HEIGHT;default:return null}},calculateNextZoomLevel:function(a){var c,d=!1,e=this.state.zoomState.zoom,f=this.zoomLevels.slice(),g=this.calculateZoomValue(b.ZOOM_AUTO),h=this.calculateZoomValue(b.ZOOM_FIT_WIDTH),i=this.calculateZoomValue(b.ZOOM_FIT_HEIGHT),j=[h,i];if(g!==h&&g!==i&&j.push(g),f=f.concat(j),f.sort(function(a,b){return a-b}),a===b.ZOOM_IN){for(c=0;c<f.length;++c)if(f[c]>e){d=f[c];break}}else if(a===b.ZOOM_OUT)for(c=f.length-1;c>=0;--c)if(f[c]<e){d=f[c];break}return d},calculateZoomValue:function(a){var c=this.state,d=parseFloat(a);return d?d:a===b.ZOOM_FIT_WIDTH?c.viewportDimensions.clientWidth/c.widestPage.totalActualWidth:a===b.ZOOM_FIT_HEIGHT?c.viewportDimensions.clientHeight/c.tallestPage.totalActualHeight:a===b.ZOOM_AUTO?this.calculateZoomAutoValue():c.zoomState.zoom},applyZoom:function(a){c(this,a)},scrollTo:function(a){var c=this.state,d=parseInt(a,10);if("string"==typeof a){if(a===b.SCROLL_PREVIOUS&&c.currentPage>1)d=this.calculatePreviousPage();else if(a===b.SCROLL_NEXT&&c.currentPage<this.numPages)d=this.calculateNextPage();else if(!d)return}else if(!d&&0!==d)return;d=o.clamp(d,1,this.numPages),this.scrollToPage(d)},scrollBy:function(a,b){a=parseInt(a,10)||0,b=parseInt(b,10)||0,this.scrollToOffset(a+this.state.scrollLeft,b+this.state.scrollTop)},scrollToPage:function(a){var b=this.calculateScrollPositionForPage(a);this.scrollToOffset(b.left,b.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(a){var b=o.clamp(a-1,0,this.numPages-1),c=this.state.pages[b];return{top:c.y0,left:c.x0}},calculateVisibleRange:function(){var a=this.state,b=a.scrollTop,c=b+a.viewportDimensions.clientHeight,d=a.scrollLeft,e=d+a.viewportDimensions.clientWidth,f=o.bisectLeft(a.pages,b,"y1"),g=o.bisectRight(a.pages,c,"y0")-1,h=o.bisectLeft(a.pages,d,"x1"),i=o.bisectRight(a.pages,e,"x0")-1,j=Math.max(h,f),k=Math.min(i,g);return o.constrainRange(j,k,this.numPages-1)},calculateFullyVisibleRange:function(){var a=this.state,b=a.scrollTop,c=b+a.viewportDimensions.clientHeight,d=a.scrollLeft,e=d+a.viewportDimensions.clientWidth,f=o.bisectLeft(a.pages,b,"y0"),g=o.bisectRight(a.pages,c,"y1")-1,h=o.bisectLeft(a.pages,d,"x0"),i=o.bisectRight(a.pages,e,"x1")-1,j=Math.max(h,f),k=Math.min(i,g);return o.constrainRange(j,k,this.numPages-1)},scrollToOffset:function(a,b){this.$viewport.scrollLeft(a),this.$viewport.scrollTop(b)},setCurrentPage:function(b){var c=this.state;c.currentPage!==b?(c.currentPage=b,this.updateVisiblePages(),a.broadcast("pagefocus",{page:c.currentPage,numPages:this.numPages,visiblePages:o.extend([],c.visiblePages),fullyVisiblePages:o.extend([],c.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(a){var b,c,d,e=this.state,f=this.calculateVisibleRange(),g=this.calculateFullyVisibleRange();for(e.visiblePages.length=0,e.fullyVisiblePages.length=0,b=0,c=this.$pages.length;c>b;++b)d=this.$pages.eq(b),b<f.min||b>f.max?a&&d.hasClass(h)&&d.removeClass(h):(a&&!d.hasClass(h)&&d.addClass(h),e.visiblePages.push(b+1)),b>=g.min&&b<=g.max&&e.fullyVisiblePages.push(b+1)},updatePageStates:function(a){var b,c,e,f,g,h=this.state,i=h.pages,j=h.rows,o=this.$viewport.scrollTop(),p=this.$viewport.scrollLeft(),q=0,r=0,s=0,t=0;for(j.length=h.sumWidths=h.sumHeights=h.totalWidth=h.totalHeight=0,h.widestPage.totalActualWidth=h.tallestPage.totalActualHeight=0,b=0,c=this.$pages.length;c>b;++b)g=this.$pages.eq(b),f=g[0],e=i[b],(!e||a)&&(g.css("padding",""),e={index:b,paddingLeft:parseFloat(g.css(m)),paddingRight:parseFloat(g.css(l)),paddingTop:parseFloat(g.css(k)),paddingBottom:parseFloat(g.css(n))}),e.actualWidth||(e.actualWidth=parseFloat(f.getAttribute("data-width"))),e.actualHeight||(e.actualHeight=parseFloat(f.getAttribute("data-height"))),e.totalActualWidth=e.actualWidth+e.paddingLeft+e.paddingRight,e.totalActualHeight=e.actualHeight+e.paddingTop+e.paddingBottom,e.width=f.offsetWidth,e.height=f.offsetHeight,e.x0=f.offsetLeft,e.y0=f.offsetTop,e.x1=e.width+e.x0,e.y1=e.height+e.y0,r&&d(i,j[q])<=e.y0+2&&q++,r=e.y1,j[q]||(j[q]=[]),e.totalActualWidth>h.widestPage.totalActualWidth&&(h.widestPage=e),e.totalActualHeight>h.tallestPage.totalActualHeight&&(h.tallestPage=e),h.sumWidths+=e.width,h.sumHeights+=e.height,e.rowIndex=q,i[b]=e,j[q].push(b),i[s].x0+i[s].width<e.x0+e.width&&(s=b),i[t].y0+i[t].height<e.y0+e.height&&(t=b);h.totalWidth=i[s].x0+i[s].width,h.totalHeight=i[t].y0+i[t].height,h.scrollTop=o,h.scrollLeft=p,this.setCurrentPage(this.calculateCurrentPage())},initZoomLevels:function(){this.zoomLevels=this.config.zoomLevels||[1],this.state.minZoom=this.config.minZoom||this.zoomLevels[0],this.state.maxZoom=this.config.maxZoom||this.zoomLevels[this.zoomLevels.length-1]},updateCurrentPage:function(){var a=this.calculateCurrentPage();this.setCurrentPage(a)},handleResize:function(a){var b=this.state.zoomState.zoomMode;this.state.viewportDimensions=a,this.setZoom(b)},handleScroll:function(a){this.state.scrollTop=a.scrollTop,this.state.scrollLeft=a.scrollLeft},handleScrollEnd:function(a){this.$pagesWrapper.find("."+f).removeClass(f),this.$pages.eq(this.state.currentPage-1).addClass(f),this.updateVisiblePages(!0),this.handleScroll(a)},updateScrollPosition:function(a){var b,c,d=this.state,e=d.zoomState,f=e.zoom/e.prevZoom;b=d.scrollLeft*f,c=d.scrollTop*f,a!==!0&&(c+=d.viewportDimensions.offsetHeight*(f-1)/2,b+=d.viewportDimensions.offsetWidth*(f-1)/2),this.scrollToOffset(b,c)},focus:function(){this.$viewport.focus()},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}}}),b.addComponent("layout-"+b.LAYOUT_HORIZONTAL,["layout-base"],function(a,c){"use strict";var d=a.getUtility("common"),e=a.getUtility("browser");return d.extend({},c,{calculateZoomAutoValue:function(){var a=this.state,c=this.calculateZoomValue(b.ZOOM_FIT_WIDTH),d=this.calculateZoomValue(b.ZOOM_FIT_HEIGHT);return a.widestPage.actualWidth>a.tallestPage.actualHeight?Math.min(c,d):e.mobile?d:Math.min(1,d)},calculateCurrentPage:function(){var a,b,c=this.state,e=c.pages;return a=d.bisectRight(e,c.scrollLeft,"x0")-1,b=d.bisectRight(e,c.scrollLeft+e[a].width/2,"x0")-1,1+b},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(a){c.handleResize.call(this,a),this.updateCurrentPage()},handleScroll:function(a){c.handleScroll.call(this,a),this.updateCurrentPage()},updateLayout:function(){var a=this.state,b=a.zoomState,c=b.zoom,d=a.sumWidths,e=Math.floor(a.tallestPage.totalActualHeight*c),f=Math.max(d,a.viewportDimensions.clientWidth),g=Math.max(e,a.viewportDimensions.clientHeight);this.$pagesWrapper.css({height:g,lineHeight:g+"px",width:f}),this.$doc.css({height:g,width:f})}})}),b.addComponent("layout-"+b.LAYOUT_PRESENTATION_TWO_PAGE,["layout-"+b.LAYOUT_PRESENTATION],function(a,c){"use strict";var d=a.getUtility("common");return d.extend({},c,{init:function(){var d=a.getConfig();d.layout=b.LAYOUT_PRESENTATION_TWO_PAGE,this.twoPageMode=!0,c.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(a){var d=c.calculateZoomValue.call(this,a);return a===b.ZOOM_FIT_WIDTH&&(d/=2),d},scrollToPage:function(a){c.scrollToPage.call(this,a-(a+1)%2)},calculateVisibleRange:function(){var a=this.state.currentPage-1,b=a+1;return d.constrainRange(a,b,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),b.addComponent("layout-"+b.LAYOUT_PRESENTATION,["layout-base"],function(a,c){"use strict";var d="crocodoc-page-",e=d+"prev",f=d+"next",g=d+"before",h=d+"after",i=d+"before-buffer",j=d+"after-buffer",k="crocodoc-current-page",l=[f,h,e,g,i,j].join(" "),m=a.getUtility("common");return m.extend({},c,{init:function(){c.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){c.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(l)},calculateZoomAutoValue:function(){var a=this.calculateZoomValue(b.ZOOM_FIT_WIDTH),c=this.calculateZoomValue(b.ZOOM_FIT_HEIGHT);return Math.min(a,c)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var a=this.state.currentPage-1;return m.constrainRange(a,a,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(a){var b=m.clamp(a-1,0,this.numPages);c.setCurrentPage.call(this,a),this.$pagesWrapper.find("."+k).removeClass(k),this.$pages.eq(this.state.currentPage-1).addClass(k),this.updateVisiblePages(!0),this.updatePageClasses(b)},scrollToPage:function(a){this.setCurrentPage(a)},updateLayout:function(){var a,b,c,d,e,f,g,h=this.state,i=h.zoomState,j=i.zoom,k=this.currentPage||1,l=h.pages[k-1],m=this.twoPageMode?h.pages[k]:l,n=h.viewportDimensions.clientWidth,o=h.viewportDimensions.clientHeight;a=m.actualWidth,b=l.actualWidth+(this.twoPageMode?a:0),c=l.actualHeight,d=Math.floor((b+l.paddingLeft+m.paddingRight)*j),e=Math.floor(l.totalActualHeight*j),f=Math.max(d,n),g=Math.max(e,o),this.$pagesWrapper.add(this.$doc).css({width:f,height:g}),this.updatePageMargins(),f>n||g>o?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var a,b,c,d,e,f,g,h,i,j=this.state,k=j.viewportDimensions.clientWidth,l=j.viewportDimensions.clientHeight;for(a=0,b=this.$pages.length;b>a;++a)d=this.$pages.eq(a),c=j.pages[a],i=this.twoPageMode?a%2===1?c.paddingRight:c.paddingLeft:c.paddingRight+c.paddingLeft,e=(c.actualWidth+i)*j.zoomState.zoom,f=(c.actualHeight+c.paddingTop+c.paddingBottom)*j.zoomState.zoom,this.twoPageMode?(g=Math.max(0,(k-2*e)/2),a%2===1&&(g+=e)):g=(k-e)/2,h=(l-f)/2,g=Math.max(g,0),h=Math.max(h,0),d.css({marginLeft:g,marginTop:h})},updatePageClasses:function(){var a=this.$pages,b=this.state.currentPage-1,c=b+1,d=b-1,k=20;a.removeClass(l),this.twoPageMode?(c=b+2,d=b-2,a.slice(Math.max(d,0),b).addClass(e),a.slice(c,c+2).addClass(f)):(d>=0&&a.eq(d).addClass(e),c<this.numPages&&a.eq(c).addClass(f)),a.slice(0,b).addClass(g),a.slice(Math.max(0,b-k),b).addClass(i),a.slice(c).addClass(h),a.slice(c,Math.min(this.numPages,c+k)).addClass(j)}})}),b.addComponent("layout-"+b.LAYOUT_VERTICAL_SINGLE_COLUMN,["layout-"+b.LAYOUT_VERTICAL],function(a,c){"use strict";var d=a.getUtility("common");return d.extend({},c,{init:function(){var d=a.getConfig();d.layout=b.LAYOUT_VERTICAL_SINGLE_COLUMN,c.init.call(this)}})}),b.addComponent("layout-"+b.LAYOUT_VERTICAL,["layout-base"],function(a,c){"use strict";var d=a.getUtility("common"),e=a.getUtility("browser");return d.extend({},c,{calculateZoomAutoValue:function(){var a=this.state,c=this.calculateZoomValue(b.ZOOM_FIT_WIDTH),d=this.calculateZoomValue(b.ZOOM_FIT_HEIGHT);return a.widestPage.actualWidth>a.tallestPage.actualHeight?Math.min(1,c,d):e.mobile?c:Math.min(1,c)},calculateCurrentPage:function(){var a,b,c,e,f,g=this.state,h=g.pages;return a=d.bisectRight(h,g.scrollTop,"y0")-1,0>a?1:(f=g.scrollTop+h[a].height/2,b=d.bisectRight(h,f,"y0")-1,c=h[b].rowIndex,e=g.rows[c],1+e[0])},calculateNextPage:function(){var a=this.state,b=a.pages[a.currentPage-1],c=b.rowIndex,d=a.rows[c+1];return d&&d[0]+1||a.currentPage},calculatePreviousPage:function(){var a=this.state,b=a.pages[a.currentPage-1],c=b.rowIndex,d=a.rows[c-1];return d&&d[0]+1||a.currentPage},handleResize:function(a){c.handleResize.call(this,a),this.updateCurrentPage()},handleScroll:function(a){c.handleScroll.call(this,a),this.updateCurrentPage()},updateLayout:function(){var a,b,c,d,e,f=this.state,g=f.zoomState.zoom;a=Math.floor(f.widestPage.totalActualWidth*g),d=Math.max(a,f.viewportDimensions.clientWidth),e=this.$pagesWrapper.height(),this.$pagesWrapper.css({height:"auto",width:d}),e=this.$pagesWrapper.height(),b=a<=f.viewportDimensions.clientWidth?"auto":a,c=e,this.$doc.css({height:c,width:b})}})}),b.addComponent("lazy-loader",function(b){"use strict";function c(a){a=a||v;var b=y.page-1,c=b-a,d=b+a;return r.constrainRange(c,d,o-1)}function d(){var a;clearTimeout(q),u.length>0?(a=u.shift(),n[a]&&n[a].errorCount<=z?t.loadPage(a,function(a){a===!1?d():q=setTimeout(d,A)}):d()):f()}function e(){clearTimeout(q),w=!1,q=setTimeout(d,A)}function f(){clearTimeout(q),w=!0}function g(a){u.push(a),w&&e()}function h(){u.length=0,f()}function i(a,b){var d=c(b);return a>=d.min&&a<=d.max?!0:!1}function j(a){var b=n[a];if(b){if(i(a))return!0;if(l(a))return!0}return!1}function k(a,b){return i(a,b)?!1:l(a)?!1:!0}function l(a){return r.inArray(a+1,y.visiblePages)>-1}function m(a,b){for(var c=r.sign(b-a);a!==b;)t.queuePageToLoad(a),a+=c;t.queuePageToLoad(a)}var n,o,p,q,r=b.getUtility("common"),s=b.getUtility("browser"),t={},u=[],v=1,w=!0,x=1,y={page:1,visiblePages:[1]},z=1,A=s.mobile||s.ielt10?100:50,B=s.mobile||s.ielt10?8:32;return r.extend(t,{messages:["beforezoom","pageavailable","pagefocus","scroll","scrollend","zoom"],onmessage:function(a,b){switch(a){case"beforezoom":this.handleBeforeZoom(b);break;case"pageavailable":this.handlePageAvailable(b);break;case"pagefocus":this.handlePageFocus(b);break;case"scroll":this.handleScroll(b);break;case"scrollend":this.handleScrollEnd(b);break;case"zoom":this.handleZoom(b)}},init:function(a){n=a,o=n.length,v=Math.min(B,o)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(a){x=r.sign(a.page-y.page),y=a},loadNecessaryPages:r.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(y.page-1),this.loadVisiblePages(),this.loadPagesInRange(v)}),loadPagesInRange:function(a){var b=y.page-1;a>0&&(a=c(a),x>=0?(m(b+1,a.max),m(b-1,a.min)):(m(b-1,a.min),m(b+1,a.max)))},loadVisiblePages:function(){var a,b;for(a=0,b=y.visiblePages.length;b>a;++a)this.queuePageToLoad(y.visiblePages[a]-1)},queuePageToLoad:function(a){j(a)&&(n[a].preload(),g(a))},cancelAllLoading:function(){clearTimeout(p),h()},loadPage:function(b,c){a.when(n[b]&&n[b].load()).fail(function(a){n[b].errorCount=n[b].errorCount||0,n[b].errorCount<z?u.unshift(b):n[b].fail(a),n[b].errorCount++}).always(c)},unloadPage:function(a){var b=n[a];b&&b.unload()},unloadUnnecessaryPages:function(a){var b,c;for(b=0,c=n.length;c>b;++b)k(b,a)&&this.unloadPage(b)},handlePageAvailable:function(a){var b;if(a.page)this.queuePageToLoad(a.page-1);else if(a.upto)for(b=0;b<a.upto;++b)this.queuePageToLoad(b)},handlePageFocus:function(a){this.updateLayoutState(a),this.cancelAllLoading(),p=setTimeout(function(){t.loadNecessaryPages()},200)},handleBeforeZoom:function(a){this.cancelAllLoading(),this.unloadUnnecessaryPages(2*a.visiblePages.length)},handleZoom:function(a){this.updateLayoutState(a),this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){this.loadNecessaryPages(),this.unloadUnnecessaryPages(v)}})}),b.addComponent("page-img",function(b){"use strict";var c,d,e,f=b.getUtility("browser"),g=!1,h=f.mobile;return{init:function(b,c){d=a(b),e=c.imgSrc+(c.queryString||"")},destroy:function(){d.empty()},preload:function(){},load:function(){var b=a.Deferred();if(c)g||b.resolve();else{var f=new window.Image;g=!0,f.onload=function(){g=!1,b.resolve()},f.onerror=function(){c=null,b.reject({error:"failed to load image"})},f.src=e,c=a(f),d.html(c)}return c.show(),b},unload:function(){g=!1,h?(c.remove(),c=null):c&&c.hide()}}}),b.addComponent("page-links",function(b){"use strict";function c(b){var c=a("<a>").addClass(f),d=b.bbox[0],g=b.bbox[1],h={};if(c.css({left:d+"pt",top:g+"pt",width:b.bbox[2]-d+"pt",height:b.bbox[3]-g+"pt"}),b.uri){if(!/^http|^mailto/.test(b.uri))return;h.href=encodeURI(b.uri),h.target="_blank"}else b.destination&&(h.href="#page-"+b.destination.pagenum);c.attr(h),c.data("link",b),c.appendTo(e)}function d(c){var d=a(c.target),e=d.data("link");e&&b.broadcast("linkclicked",e),c.preventDefault()}var e,f="crocodoc-page-link";return{init:function(b,c){e=a(b),this.createLinks(c),e.on("click","."+f,d)},destroy:function(){e.empty().off("click")},createLinks:function(a){var b,d;for(b=0,d=a.length;d>b;++b)c(a[b])}}}),b.addComponent("page-svg",function(b){"use strict";function c(){switch(P){case x:case D:return a("<iframe>");case C:case y:return a("<object>").attr({type:t,data:"data:"+t+";base64,"+window.btoa(w)});case z:return a('<div style="width:100%; height:100%;">');case A:return a("<object>");case B:case E:return a("<img>")
}}function d(){j&&0!==j.length||(M=!1,j=c()),0===j.parent().length&&j.appendTo(k)}function e(a){var b,c,d=p.replace("&","&#38;");return b=F.countInStr(a,'xlink:href="data:image'),b>s&&(a=a.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),a=a.replace(/href="([^"#:]*)"/g,function(a,b){return'href="'+o+b+d+'"'}),c="<style>"+N.cssText+"</style>",H.firefox&&!I.isSubpxSupported()&&(c+="<style>text { text-rendering: geometricPrecision; }</style>"),a=a.replace(/<xhtml:link[^>]*>/,c)}function f(){if(l)return l;var b=q+p,c=a.Deferred();return j?(m=G.request(b,{success:function(){if(!K){var a=this.responseText;if(!a)return void c.reject({error:"Response was empty",status:200,resource:b});a=e(a),r=a,c.resolve()}},fail:function(){K||(r=null,c.reject({error:this.statusText,status:this.status,resource:b}))}}),l=c.promise()):void c.reject({error:"Error creating SVG element",status:200,resource:b})}function g(){var a,b,c,d,e,f=j[0].contentDocument,g=j[0].contentWindow||f&&f.defaultView;switch(P){case x:H.ie&&H.version<10&&(r=r.replace(/<xhtml:link.*/,"")),d=u+r,f.open(),f.write(d),f.close(),c=f.getElementsByTagName("svg")[0];break;case D:return d=u+F.template(v,{encodedScript:window.btoa("("+h+")()")}),f.open(),f.write(d),f.close(),void("complete"===f.readyState?(g.loadSVG(r),O||(r=null)):g.onload=function(){this.loadSVG(r),O||(r=null)});case y:a=new J,b=a.parseFromString(r,t),c=f.importNode(b.documentElement,!0),f.documentElement.appendChild(c);break;case C:g.loadSVG(r),c=f.querySelector("svg");break;case z:a=new J,b=a.parseFromString(r,t),c=document.importNode(b.documentElement,!0),j.append(c);break;case A:j.attr({type:t,data:q+p}),c=j[0];break;case B:c=j[0],c.src=q+p;break;case E:c=j[0],e="data:"+t,c.src=!H.ie&&window.btoa?e+";base64,"+window.btoa(r):e+","+encodeURIComponent(r)}O||(r=null),c.setAttribute("width","100%"),c.setAttribute("height","100%")}function h(){window.loadSVG=function(a){var b=new window.DOMParser,c=b.parseFromString(a,"image/svg+xml"),d=document.importNode(c.documentElement,!0);d.setAttribute("width","100%"),d.setAttribute("height","100%"),document.body?document.body.appendChild(d):document.documentElement.appendChild(d)}}function i(a){a?(b.broadcast("asseterror",a),M=!1,l=null):(0===j.parent().length&&j.appendTo(k),j.show(),M=!0)}var j,k,l,m,n,o,p,q,r,s=100,t="image/svg+xml",u="<style>html, body { width:100%; height: 100%; margin: 0; overflow: hidden; }</style>",v='<script type="text/javascript" src="data:text/javascript;base64,{{encodedScript}}"></script>',w='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+h+")()]]></script></svg>",x=1,y=2,z=3,A=4,B=5,C=6,D=7,E=8,F=b.getUtility("common"),G=b.getUtility("ajax"),H=b.getUtility("browser"),I=b.getUtility("subpx"),J=window.DOMParser,K=!1,L=!1,M=!1,N=b.getConfig(),O=H.mobile||H.ielt10,P=H.ie?E:H.firefox?E:H.safari?D:x;return{init:function(a,b){k=a,n=b,o=n.url,q=n.svgSrc,p=n.queryString||"",P=N.embedStrategy||P},destroy:function(){K=!0,this.unload(),k.empty()},preload:function(){d(),f()},load:function(){L=!1;var b=a.Deferred();return M?(i(),b.resolve()):(d(),P===A||P===B?(g(),i(),b.resolve()):f().then(function(){K||L||(g(),i(),b.resolve())}).fail(function(a){i(a),b.reject(a)}).always(function(){m=null})),b},unload:function(){L=!0,m&&m.abort&&(m.abort(),m=null,l=null),O?(j&&(j.remove(),j=null),M=!1):M&&j.hide()}}}),b.addComponent("page-text",function(b){"use strict";function c(){return t.enableTextSelection&&!n.ielt9}function d(a){var b,c;if(a&&!s){s=!0;var d=q.countInStr(a,"<div");d>m||(a=a.replace(/<link rel="stylesheet".*/,""),b=document.implementation.createHTMLDocument(""),b.getElementsByTagName("body")[0].innerHTML=a,a=null,c=document.importNode(b.querySelector("."+l),!0),g.attr("class",c.getAttribute("class")),g.html(c.innerHTML),o.fix(g))}}function e(a){b.broadcast("asseterror",a)}function f(){if(i)return i;var b=a.Deferred();return h=p.request(j,{success:function(){r||(h=null,0===this.responseText.length&&e({error:"empty response",status:this.status,resource:j}),b.resolve(this.responseText))},fail:function(){r||(h=null,e({error:this.statusText,status:this.status,resource:j}),b.resolve())}}),i=b.promise()}var g,h,i,j,k,l="crocodoc-page-text",m=256,n=b.getUtility("browser"),o=b.getUtility("subpx"),p=b.getUtility("ajax"),q=b.getUtility("common"),r=!1,s=!1,t=b.getConfig();return{init:function(a,b){g=a,k=b,j=k.textSrc+k.queryString},destroy:function(){r=!0,g.empty()},preload:function(){c()&&f()},load:function(){return c()?f().then(d):!1},unload:function(){h&&h.abort&&(h.abort(),h=null,i=null)},enable:function(){g.css("display","")},disable:function(){g.css("display","none")}}}),b.addComponent("page",function(c){"use strict";var d,e,f,g,h,i,j,k,l="crocodoc-page-",m=l+"inner",n=l+"loading",o=l+"error",p=l+"text",q=l+"svg",r=l+"links",s=c.getUtility("support"),t=c.getUtility("common"),u=!1;return{errorCount:0,messages:["pageavailable","textenabledchange","pagefocus","zoom"],onmessage:function(a,c){switch(a){case"pageavailable":(c.page===i+1||c.upto>i)&&k===b.PAGE_STATUS_CONVERTING&&(k=b.PAGE_STATUS_NOT_LOADED);break;case"textenabledchange":c.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":j=h===c.page||t.inArray(h,c.visiblePages)>-1}},init:function(a,j){var l,n,o,t;d=a,o=d.find("."+m),n=o.find("."+q),l=o.find("."+p),t=o.find("."+r),j.url=j.url||"",e=c.createComponent("page-text"),f=c.createComponent(s.svg?"page-svg":"page-img"),e.init(l,j),f.init(n,j),j.enableLinks&&j.links.length&&(g=c.createComponent("page-links"),g.init(t,j.links)),k=j.status||b.PAGE_STATUS_NOT_LOADED,i=j.index,h=i+1,this.config=j},destroy:function(){this.unload()},preload:function(){k===b.PAGE_STATUS_NOT_LOADED&&(f.preload(),e.preload())},load:function(){var g,i=this;return u=!0,k===b.PAGE_STATUS_LOADED||k===b.PAGE_STATUS_LOADING?(g=e.load(),g&&"pending"!==g.state()?!1:g):k===b.PAGE_STATUS_CONVERTING?!1:(d.removeClass(o),k=b.PAGE_STATUS_LOADING,a.when(f.load(),e.load()).done(function(){u?(k=b.PAGE_STATUS_LOADED,d.removeClass(n),c.broadcast("pageload",{page:h})):i.unload()}).fail(function(){k=b.PAGE_STATUS_NOT_LOADED,d.removeClass(n)}))},fail:function(a){k=b.PAGE_STATUS_ERROR,d.addClass(o),c.broadcast("pagefail",{page:i+1,error:a})},unload:function(){u=!1,f.unload(),e.unload(),k===b.PAGE_STATUS_LOADED&&(k=b.PAGE_STATUS_NOT_LOADED,d.addClass(n),d.removeClass(o),c.broadcast("pageunload",{page:h}))},enableTextSelection:function(){e.enable(),j&&e.load()},disableTextSelection:function(){e.disable()}}}),b.addComponent("resizer",function(b){"use strict";function c(){b.broadcast("resize",{width:i,height:j,clientWidth:g,clientHeight:h,offsetWidth:i,offsetHeight:j})}function d(){e(),k=l.requestAnimationFrame(d,f)}function e(){var a=f.offsetHeight,b=f.offsetWidth;a&&(a!==j||b!==i)&&(j=a,i=b,h=f.clientHeight,g=f.clientWidth,c())}var f,g,h,i,j,k,l=b.getUtility("support"),m=["webkit"," moz"," ms"," ",""].join("fullscreenchange");return{messages:["ready"],onmessage:function(a){"ready"===a&&d()},init:function(b){f=a(b).get(0),a(document).on(m,c)},destroy:function(){a(document).off(m,c),l.cancelAnimationFrame(k)}}}),b.addComponent("scroller",function(b){"use strict";function c(){return{scrollTop:j.scrollTop(),scrollLeft:j.scrollLeft()}}function d(){r=!1,w=null,clearTimeout(k),b.broadcast("scrollend",c())}function e(){r||(r=!0,b.broadcast("scrollstart",c())),clearTimeout(k),k=setTimeout(d,q),x()}function f(){s=!0,t=!1,u=!1,e()}function g(){u=!0,e()}function h(){s=!1,t=!0,v=(new Date).getTime(),u&&i()}function i(){return clearTimeout(k),null===w&&(w=(new Date).getTime()),(new Date).getTime()-w>n?void d():(x(),void(k=setTimeout(i,o)))}var j,k,l=b.getUtility("common"),m=b.getUtility("browser"),n=3e3,o=30,p=200,q=m.mobile?500:250,r=!1,s=!1,t=!1,u=!1,v=0,w=null,x=l.throttle(p,function(){b.broadcast("scroll",c())});return{init:function(b){j=a(b),j.on("scroll",e),j.on("touchstart",f),j.on("touchmove",g),j.on("touchend",h)},destroy:function(){clearTimeout(k),j.off("scroll",e),j.off("touchstart",f),j.off("touchmove",g),j.off("touchend",h)}}}),b.addComponent("viewer-base",function(c){"use strict";function d(){u.attr(C,t.metadata.version||"0.0.0"),Z.mobile&&u.addClass(L),Z.ielt9&&u.addClass(M),$.svg&&u.addClass(N)}function e(){var a=t.metadata;t.numPages=a.numpages,t.pageStart?t.pageStart<0&&(t.pageStart=a.numpages+t.pageStart):t.pageStart=1,t.pageStart=X.clamp(t.pageStart,1,a.numpages),t.pageEnd?t.pageEnd<0&&(t.pageEnd=a.numpages+t.pageEnd):t.pageEnd=a.numpages,t.pageEnd=X.clamp(t.pageEnd,t.pageStart,a.numpages),t.numPages=t.pageEnd-t.pageStart+1}function f(){t.$viewport=a('<div tabindex="-1">').addClass(G),t.$doc=a("<div>").addClass(E),t.$pagesWrapper=a("<div>").addClass(F),t.$doc.append(t.$pagesWrapper),t.$viewport.append(t.$doc),u.html(t.$viewport)}function g(){var b,c,d,e,f,g,h,i,j=X.calculatePtSize(),k=t.metadata.dimensions,l="";for(t.pageScale=W/(k.width*j),d=t.zoomLevels[t.zoomLevels.length-1],e=3/t.pageScale;e>d;)d+=d/2,t.zoomLevels.push(d);for(k.exceptions=k.exceptions||{},b=t.pageStart-1;b<t.pageEnd;b++)c=b+1,c in k.exceptions?(f=k.exceptions[c].width,g=k.exceptions[c].height):(f=k.width,g=k.height),h=f*j,i=g*j,h*=t.pageScale,i*=t.pageScale,l+=X.template(V,{w:h,h:i});t.$pages=a(l).appendTo(t.$pagesWrapper)}function h(){var a,b,d=t.plugins||{};for(a in d)b=c.createComponent("plugin-"+a),b&&X.isFn(b.init)&&b.init(t.plugins[a])}function i(){d(),g(),j(),l(),w=c.createComponent("lazy-loader"),w.init(t.pages),y=c.createComponent("scroller"),y.init(t.$viewport),z=c.createComponent("resizer"),z.init(t.$viewport),(!t.enableLinks||Z.ielt9)&&s.disableLinks(),u.removeClass(H),s.setLayout(t.layout),c.broadcast("ready",{page:t.page||1,numPages:t.numPages})}function j(){var a,d,e,f,g,h,i=[],j=t.pageStart-1,l=t.pageEnd,m=X.makeAbsolute(t.url),n=t.conversionIsComplete?b.PAGE_STATUS_NOT_LOADED:b.PAGE_STATUS_CONVERTING,o=k();for(a=j;l>a;a++)e=m+X.template(t.template.svg,{page:a+1}),g=m+X.template(t.template.html,{page:a+1}),f=m+X.template(t.template.img,{page:a+1}),h=m+t.template.css,d=c.createComponent("page"),d.init(t.$pages.eq(a-j),{index:a,url:m,imgSrc:f,svgSrc:e,textSrc:g,cssSrc:h,status:n,queryString:t.queryString,enableLinks:t.enableLinks,links:o[a],pageScale:t.pageScale}),i.push(d);t.pages=i}function k(){var a,b,c,d=t.metadata.links||[],e=[];for(a=0,b=t.metadata.numpages;b>a;++a)e[a]=[];for(a=0,b=d.length;b>a;++a)c=d[a],e[c.pagenum-1].push(c);return e}function l(){a(document).on("mouseup",n)}function m(a){a.uri?window.open(a.uri):a.destination&&s.scrollTo(a.destination.pagenum)}function n(){p()}function o(b,d){function e(a){c.broadcast("asseterror",a),d?o(b,!1).then(function(a){f.resolve(a)}).fail(function(a){f.reject(a)}):f.reject(a)}var f=a.Deferred();return Y.request(b,{success:function(){return _?void 0:this.responseText?void f.resolve(this.responseText):void e({error:"empty response",status:this.status,resource:b})},fail:function(){_||e({error:this.statusText,status:this.status,resource:b})}}),f.promise()}function p(){var b=X.getSelectedNode(),c=a(b).closest("."+O);u.find("."+K).removeClass(K),b&&u.has(b)&&c.addClass(K)}function q(a){a?A||(u.addClass(I),A=c.createComponent("dragger"),A.init(t.$viewport)):A&&(u.removeClass(I),c.destroyComponent(A),A=null)}function r(){var b;t.queryParams&&(b="string"==typeof t.queryParams?t.queryParams.replace(/^\?/,""):a.param(t.queryParams)),t.queryString=b?"?"+b:""}var s,t,u,v,w,x,y,z,A,B="crocodoc-",C="data-svg-version",D=B+"viewer",E=B+"doc",F=B+"pages",G=B+"viewport",H=B+"loading",I=B+"draggable",J=B+"dragging",K=B+"text-selected",L=B+"mobile",M=B+"ielt9",N=B+"supports-svg",O=B+"page",P=O+"-inner",Q=O+"-svg",R=O+"-text",S=O+"-links",T=O+"-overlay",U=O+"-loading",V='<div class="'+O+" "+U+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+P+'"><div class="'+Q+'"></div><div class="'+T+'"><div class="'+R+'"></div><div class="'+S+'"></div></div></div></div>',W=1024,X=c.getUtility("common"),Y=c.getUtility("ajax"),Z=c.getUtility("browser"),$=c.getUtility("support"),_=!1;return{messages:["asseterror","destroy","dragend","dragstart","fail","linkclicked","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(a,b){switch(a){case"linkclicked":m(b);break;case"zoom":b.zoom*=t.pageScale,b.prevZoom*=t.pageScale,t.enableDragging&&q(b.isDraggable),s.fire(a,b);break;case"dragstart":u.hasClass(J)||u.addClass(J),s.fire(a,b);break;case"dragend":u.hasClass(J)&&u.removeClass(J),s.fire(a,b);break;default:s.fire(a,b)}},init:function(){t=c.getConfig(),s=t.api,t.namespace=D+"-"+t.id,u=t.$el,u.addClass(D),u.addClass(t.namespace),f(),h()},destroy:function(){a(document).off("mouseup",n),u.empty().removeClass(function(a,b){var c=b.match(new RegExp("crocodoc\\S+","g"));return c&&c.join(" ")}),a(v).remove(),_=!0},setLayout:function(a){var b,d=t.page,e=t.zoom||1;if(x){if(a===t.layout)return x;d=x.state.currentPage,e=x.state.zoomState}if(b=c.createComponent("layout-"+a),!b)throw new Error("Invalid layout "+a);return x&&c.destroyComponent(x),t.layout=a,x=b,x.init(),x.setZoom(e.zoomMode||e.zoom||e),x.scrollTo(d),t.currentLayout=x,x},loadAssets:function(){var b,d,f=X.makeAbsolute(t.url),g=f+t.template.css,h=f+t.template.json;r(),g+=t.queryString,h+=t.queryString,d=o(h,!0),d.then(function(b){t.metadata=a.parseJSON(b),e()}),Z.ielt9?(v=X.insertCSS(""),t.stylesheet=v.styleSheet,b=a.when()):(b=o(g,!0),b.then(function(a){t.cssText=a,v=X.insertCSS(a),t.stylesheet=v.sheet})),a.when(d,b).fail(function(a){c.broadcast("fail",a)}).then(i)}}}),b}(jQuery);